(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{49:e=>{e.exports={container:"ChatInterface_container__oEkvy",header:"ChatInterface_header__642mN",clearButton:"ChatInterface_clearButton__aF02u",messagesContainer:"ChatInterface_messagesContainer__4leAa",placeholder:"ChatInterface_placeholder__Z6jND",generating:"ChatInterface_generating__D4BCt",error:"ChatInterface_error__TdUcn"}},768:e=>{e.exports={container:"PCSlider_container__GRs5n",header:"PCSlider_header__HcE_7",labelGroup:"PCSlider_labelGroup__m8jL4",label:"PCSlider_label__kXLzb",description:"PCSlider_description__x5LXi",direction:"PCSlider_direction__WzV_8",value:"PCSlider_value__2zioW",sliderRow:"PCSlider_sliderRow__53e78",slider:"PCSlider_slider__VjGJi",resetButton:"PCSlider_resetButton__z9k2v",labels:"PCSlider_labels__uSjd8"}},2619:e=>{e.exports={message:"Message_message__9rnx0",user:"Message_user__VGUbV",assistant:"Message_assistant__9abDL",role:"Message_role__eIHB7",content:"Message_content__fHrmG",continueButton:"Message_continueButton__TGP_1"}},4207:e=>{e.exports={container:"TokenControls_container__xSscw",control:"TokenControls_control__0UKf9",input:"TokenControls_input__Mvj9a",hint:"TokenControls_hint___qhUn"}},6839:(e,n,s)=>{Promise.resolve().then(s.bind(s,8523))},7241:e=>{e.exports={container:"InputArea_container__I67nm",textarea:"InputArea_textarea__cXCYO",sendButton:"InputArea_sendButton__OIYmK"}},8523:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>E});var t=s(5155),a=s(2115);let r=e=>{let n,s=new Set,t=(e,t)=>{let a="function"==typeof e?e(n):e;if(!Object.is(a,n)){let e=n;n=(null!=t?t:"object"!=typeof a||null===a)?a:Object.assign({},n,a),s.forEach(s=>s(n,e))}},a=()=>n,r={setState:t,getState:a,getInitialState:()=>i,subscribe:e=>(s.add(e),()=>s.delete(e))},i=n=e(t,a,r);return r},i=e=>{let n=(e=>e?r(e):r)(e),s=e=>(function(e,n=e=>e){let s=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>n(e.getState()),[e,n]),a.useCallback(()=>n(e.getInitialState()),[e,n]));return a.useDebugValue(s),s})(n,e);return Object.assign(s,n),s},l=e=>e?i(e):i,o=l(e=>({messages:[],isGenerating:!1,error:null,numTokens:50,continuationIndex:null,addMessage:n=>e(e=>({messages:[...e.messages,n]})),clearMessages:()=>e({messages:[],continuationIndex:null}),setGenerating:n=>e({isGenerating:n}),setError:n=>e({error:n}),setNumTokens:n=>e({numTokens:n}),removeLastMessage:()=>e(e=>({messages:e.messages.slice(0,-1),continuationIndex:null})),updateLastMessage:(n,s)=>e(e=>{if(0===e.messages.length)return e;let t=[...e.messages],a=t.length-1,r=t[a];return t[a]={...r,content:n,...void 0!==s?{terminating:s}:{}},{messages:t}}),appendToAssistantMessage:(n,s,t)=>e(e=>{if(n<0||n>=e.messages.length)return e;let a=e.messages[n];if("assistant"!==a.role)return e;let r=[...e.messages];return r[n]={...a,content:a.content+s,terminating:t},{messages:r}}),setContinuationIndex:n=>e({continuationIndex:n})})),c=l((e,n)=>({pcValues:{},setPCValue:(n,s)=>e(e=>({pcValues:{...e.pcValues,[n]:s}})),resetPC:n=>e(e=>{let s={...e.pcValues};return delete s[n],{pcValues:s}}),resetAll:()=>e({pcValues:{}}),getPCValues:()=>{let e=n().pcValues,s={};return Object.entries(e).forEach(e=>{let[n,t]=e;Math.abs(t)>1&&(s[n]=t)}),s}}));async function d(e,n,s){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=await fetch("".concat("http://localhost:8000","/api/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,steering_config:{pc_values:n},num_tokens:s,is_partial:t})});if(!a.ok)throw Error((await a.json()).detail||"Generation failed");return a.json()}var u=s(2619),_=s.n(u);function m(e){let{role:n,content:s,terminating:a=!0,onContinue:r,isContinuing:i=!1}=e;return(0,t.jsxs)("div",{className:"".concat(_().message," ").concat(_()[n]),children:[(0,t.jsx)("div",{className:_().role,children:"user"===n?"You":"Assistant"}),(0,t.jsx)("div",{className:_().content,children:s}),"assistant"===n&&!a&&r&&(0,t.jsx)("button",{type:"button",className:_().continueButton,onClick:r,disabled:i,children:i?"Continuingâ€¦":"Continue message"})]})}var h=s(7241),g=s.n(h);function p(e){let{onSend:n,disabled:s,placeholder:r="Type a message..."}=e,[i,l]=(0,a.useState)(""),o=()=>{let e=i.trim();e&&!s&&(n(e),l(""))};return(0,t.jsxs)("div",{className:g().container,children:[(0,t.jsx)("textarea",{className:g().textarea,value:i,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:r,disabled:s,rows:3}),(0,t.jsx)("button",{className:g().sendButton,onClick:o,disabled:s||!i.trim(),children:"Send"})]})}var x=s(49),C=s.n(x);function j(){let e=(0,a.useRef)(null),{messages:n,isGenerating:s,error:r,numTokens:i,addMessage:l,clearMessages:u,setGenerating:_,setError:h,appendToAssistantMessage:g,setContinuationIndex:x,continuationIndex:j}=o(),{getPCValues:v}=c();(0,a.useEffect)(()=>{var n;null==(n=e.current)||n.scrollIntoView({behavior:"smooth"})},[n]);let b=async e=>{let s={role:"user",content:e};l(s),h(null),_(!0);try{let e=[...n,s],t=await d(e,v(),i,!1);l({role:"assistant",content:t.content,terminating:t.terminating})}catch(e){h(e instanceof Error?e.message:"Generation failed")}finally{_(!1)}},f=async e=>{if(!s){h(null),_(!0),x(e);try{var n,t;let s=o.getState().messages,a=s.length-1;if(e!==a||(null==(n=s[e])?void 0:n.role)!=="assistant"||(null==(t=s[e])?void 0:t.terminating)!==!1)throw Error("Message is not eligible for continuation");let r=await d(s,v(),i,!0);g(e,r.content,r.terminating)}catch(e){h(e instanceof Error?e.message:"Generation failed")}finally{_(!1),x(null)}}};return(0,t.jsxs)("div",{className:C().container,children:[(0,t.jsxs)("div",{className:C().header,children:[(0,t.jsx)("h2",{children:"Chat"}),(0,t.jsx)("button",{className:C().clearButton,onClick:u,disabled:s||0===n.length,children:"Clear"})]}),(0,t.jsxs)("div",{className:C().messagesContainer,children:[0===n.length?(0,t.jsx)("div",{className:C().placeholder,children:"Start a conversation by typing a message below"}):n.map((e,a)=>{let r="assistant"===e.role&&!1===e.terminating&&a===n.length-1;return(0,t.jsx)(m,{role:e.role,content:e.content,terminating:e.terminating,onContinue:r?()=>f(a):void 0,isContinuing:j===a&&s},a)}),s&&(0,t.jsx)("div",{className:C().generating,children:"Generating..."}),r&&(0,t.jsxs)("div",{className:C().error,children:["Error: ",r]}),(0,t.jsx)("div",{ref:e})]}),(0,t.jsx)(p,{onSend:b,disabled:s,placeholder:"Type your message..."})]})}var v=s(768),b=s.n(v);function f(e){let{pcIndex:n,label:s,description:a,recommendedDirection:r}=e,{pcValues:i,setPCValue:l,resetPC:o}=c(),d=i[n]||0;return(0,t.jsxs)("div",{className:b().container,children:[(0,t.jsxs)("div",{className:b().header,children:[(0,t.jsxs)("div",{className:b().labelGroup,children:[(0,t.jsx)("label",{className:b().label,children:s}),a&&(0,t.jsxs)("span",{className:b().description,children:[a,r&&(0,t.jsxs)("span",{className:b().direction,children:["(",r,")"]})]})]}),(0,t.jsx)("span",{className:b().value,children:d})]}),(0,t.jsxs)("div",{className:b().sliderRow,children:[(0,t.jsx)("input",{type:"range",className:b().slider,min:"-5000",max:"5000",step:"100",value:d,onChange:e=>{l(n,Number(e.target.value))}}),(0,t.jsx)("button",{className:b().resetButton,onClick:()=>{o(n)},disabled:0===d,children:"Reset"})]}),(0,t.jsxs)("div",{className:b().labels,children:[(0,t.jsx)("span",{children:"-5000"}),(0,t.jsx)("span",{children:"0"}),(0,t.jsx)("span",{children:"+5000"})]})]})}var N=s(9087),P=s.n(N);function S(){let{resetAll:e,pcValues:n}=c(),s=Object.keys(n).some(e=>0!==n[Number(e)]);return(0,t.jsxs)("div",{className:P().container,children:[(0,t.jsxs)("div",{className:P().header,children:[(0,t.jsx)("h2",{children:"PC Steering Controls"}),(0,t.jsx)("button",{className:P().resetAllButton,onClick:e,disabled:!s,children:"Reset All"})]}),(0,t.jsx)("div",{className:P().sliders,children:[{name:"PC1",desc:"complexity",direction:"neg"},{name:"PC2",desc:"roleplaying",direction:"neg"},{name:"PC3",desc:"humanity",direction:"pos"},{name:"PC4",desc:"emotion",direction:"neg"},{name:"PC5",desc:"wisdom",direction:"pos"},{name:"PC6",desc:"confidence",direction:"neg"},{name:"PC7",desc:"naivete",direction:"pos"},{name:"PC8",desc:"",direction:""},{name:"PC9",desc:"",direction:""},{name:"PC10",desc:"",direction:""}].map((e,n)=>(0,t.jsx)(f,{pcIndex:n,label:e.name,description:e.desc,recommendedDirection:e.direction},n))})]})}var k=s(4207),y=s.n(k);function I(){let{numTokens:e,setNumTokens:n}=o();return(0,t.jsxs)("div",{className:y().container,children:[(0,t.jsx)("h3",{children:"Generation Settings"}),(0,t.jsxs)("div",{className:y().control,children:[(0,t.jsx)("label",{htmlFor:"tokens",children:"Number of Tokens:"}),(0,t.jsx)("input",{id:"tokens",type:"number",min:"1",max:"500",value:e,onChange:e=>{let s=Number(e.target.value);s>0&&s<=500&&n(s)},className:y().input}),(0,t.jsx)("span",{className:y().hint,children:"1-500 tokens"})]})]})}var w=s(9243),B=s.n(w);function E(){return(0,t.jsxs)("main",{className:B().main,children:[(0,t.jsxs)("div",{className:B().header,children:[(0,t.jsx)("h1",{children:"Persona Steering Interface"}),(0,t.jsx)("p",{children:"Control Gemma-3-12b behavior with PC-based steering"})]}),(0,t.jsxs)("div",{className:B().content,children:[(0,t.jsx)("div",{className:B().leftColumn,children:(0,t.jsx)(j,{})}),(0,t.jsxs)("div",{className:B().rightColumn,children:[(0,t.jsx)(I,{}),(0,t.jsx)(S,{})]})]})]})}},9087:e=>{e.exports={container:"SteeringPanel_container__Xvobo",header:"SteeringPanel_header__LiyQP",resetAllButton:"SteeringPanel_resetAllButton__tW2as",sliders:"SteeringPanel_sliders__lUe4w"}},9243:e=>{e.exports={main:"page_main__nw1Wk",header:"page_header__oRW75",content:"page_content___38fW",leftColumn:"page_leftColumn__gOFov",rightColumn:"page_rightColumn__1r0p7"}}},e=>{e.O(0,[141,441,255,358],()=>e(e.s=6839)),_N_E=e.O()}]);